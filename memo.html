<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>메모 앱</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        body {
            font-family: Arial, sans-serif;
            background-color: #f5f5f5;
        }
        #memo-container {
            width: 100%;
            max-width: 600px;
            margin: 40px auto;
            padding: 20px;
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }
        #memo-text {
            width: 100%;
            height: 200px;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            resize: none;
            font-size: 16px;
        }
        button {
            cursor: pointer;
            padding: 8px 12px;
            font-size: 16px;
            border: none;
            border-radius: 5px;
            margin-top: 10px;
            margin-right: 10px;
        }
        #send-memo {
            background-color: #4caf50;
            color: white;
        }
        #delete-all-memos {
            background-color: #f44336;
            color: white;
        }
        #memos-display {
            margin-top: 20px;
        }
        .memo {
            background-color: #f1f1f1;
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 10px;
        }
        .memo button {
            background-color: #ff5722;
            font-size: 14px;
            padding: 4px 8px;
        }

        /* 반응형 디자인 미디어 쿼리 */
        @media screen and (max-width: 600px) {
            #memo-container {
                margin: 20px 10px;
                padding: 15px;
            }
            button {
                font-size: 14px;
                padding: 6px 10px;
            }
        }
    </style>

    <!-- Firebase App (필수) -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <!-- Firestore (선택) -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
</head>
<body>
  <div id="memo-container">
      <textarea id="memo-text" placeholder="메모를 입력하세요..."></textarea>
      <button id="send-memo">메모 전송</button>
      <button id="delete-all-memos">전체 메모 삭제</button>
      <div id="memos-display"></div>
  </div>

    <script>
      const firebaseConfig = {
        apiKey: "AIzaSyABpvKxndo3pTqz2M9KRMmLT04QRE4fTcc",
        authDomain: "updown-e4a97.firebaseapp.com",
        projectId: "updown-e4a97",
        storageBucket: "updown-e4a97.appspot.com",
        messagingSenderId: "187528912548",
        appId: "1:187528912548:web:a9885e744fd65b821b9031",
        measurementId: "G-5BEK63C65L"
      };
      firebase.initializeApp(firebaseConfig);

        // Firestore 초기화
        const db = firebase.firestore();

        // HTML 요소 선택
        const memoText = document.getElementById('memo-text');
        const sendMemoBtn = document.getElementById('send-memo');
        const deleteMemoBtn = document.getElementById('delete-memo');
        const memosDisplay = document.getElementById('memos-display');
        const deleteAllMemosBtn = document.getElementById('delete-all-memos');

        // 메모 전송 함수
        function sendMemo() {
            const memo = memoText.value;
            const createdAt = new Date();

            db.collection('memos').add({
                content: memo,
                createdAt: createdAt
            }).then(() => {
                memoText.value = '';
                loadMemos();
            });
        }

        // 메모 삭제 함수
        function deleteMemo(memoId) {
            db.collection('memos').doc(memoId).delete().then(() => {
                loadMemos();
            });
        }

        // 저장된 메모 불러오기 함수
        function loadMemos() {
            memosDisplay.innerHTML = '';

            db.collection('memos').orderBy('createdAt', 'desc').get().then((querySnapshot) => {
                querySnapshot.forEach((doc) => {
                    const memoData = doc.data();
                    const memoId = doc.id;
                    const memoDiv = document.createElement('div');
                    memoDiv.className = 'memo';

                    memoDiv.innerHTML = `
                        <p>${memoData.content.replace(/\n/g, '<br>')}</p>
                        <button onclick="deleteMemo('${memoId}')">삭제</button>
                    `;

                    memosDisplay.appendChild(memoDiv);
                });
            });
        }

        // 전체 메모 삭제 함수
        function deleteAllMemos() {
          db.collection('memos').get().then((querySnapshot) => {
            querySnapshot.forEach((doc) => {
              db.collection('memos').doc(doc.id).delete();
            });
            loadMemos();
          });
        }

        // 이벤트 리스너 등록
        sendMemoBtn.addEventListener('click', sendMemo);
        deleteAllMemosBtn.addEventListener('click', deleteAllMemos);

        // 저장된 메모 초기 로딩
        loadMemos();

        // 작성 시간 포맷 함수
        function formatTime(date) {
            const year = date.getFullYear();
            const month = (date.getMonth() + 1).toString().padStart(2, '0');
            const day = date.getDate().toString().padStart(2, '0');
            const hours = date.getHours().toString().padStart(2, '0');
            const minutes = date.getMinutes().toString().padStart(2, '0');
            const seconds = date.getSeconds().toString().padStart(2, '0');

            return `${year}-${month}-${day} ${hours}:${minutes}:${seconds}`;
        }

        // 저장된 메모 불러오기 함수
        function loadMemos() {
            memosDisplay.innerHTML = '';

            db.collection('memos').orderBy('createdAt', 'desc').get().then((querySnapshot) => {
                querySnapshot.forEach((doc) => {
                    const memoData = doc.data();
                    const memoId = doc.id;
                    const memoDiv = document.createElement('div');
                    memoDiv.className = 'memo';
                    const formattedTime = formatTime(memoData.createdAt.toDate());

                    memoDiv.innerHTML = `
                        <p>${memoData.content.replace(/\n/g, '<br>')}</p>
                        <p>작성 시간: ${formattedTime}</p>
                        <button onclick="deleteMemo('${memoId}')">삭제</button>
                    `;

                    memosDisplay.appendChild(memoDiv);
                });
            });
        }

      </script>
    </body>
  </html>
